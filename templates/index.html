<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <!-- RENDER.COM OPTIMIZED: Enhanced mobile viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>üì∞ NeoAI News Portal - AI-Powered Financial News</title>
    
    <!-- SEO & Social Meta -->
    <meta name="description" content="NeoAI-powered financial news portal with real-time updates and AI analysis. Modern purple-themed interface with glassmorphism design.">
    <meta name="keywords" content="AI news, financial news, NeoAI, purple theme, modern UI, news portal">
    <meta name="author" content="NeoAI News Portal">
    <meta name="robots" content="index, follow">
    
    <!-- Mobile App Experience -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NeoAI News">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-navbutton-color" content="#667eea">
    
    <!-- Prevent auto-zoom on iOS -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="{{ url_for('static', filename='script.js') }}" as="script">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∞</text></svg>">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#neo-main-content" class="sr-only sr-only-focusable">B·ªè qua ƒë·ªÉ ƒë·∫øn n·ªôi dung ch√≠nh</a>
    
    <!-- NeoAI App Container -->
    <div class="neo-app">
        <!-- Header Navigation -->
        <header class="neo-header" role="banner">
            <nav class="neo-nav">
                <!-- Logo -->
                <a href="/" class="neo-logo" aria-label="NeoAI News Portal - Trang ch·ªß">
                    <div class="neo-logo-icon" role="img" aria-label="Logo NeoAI">üì∞</div>
                    <h1 class="neo-logo-text">NeoAI News</h1>
                </a>
                
                <!-- Navigation Pills -->
                <div class="neo-nav-pills" role="navigation" aria-label="Lo·∫°i tin t·ª©c">
                    <button class="neo-nav-pill active" data-type="all" aria-pressed="true" aria-label="T·∫•t c·∫£ tin t·ª©c">
                        <span class="neo-nav-pill-icon" role="img" aria-hidden="true">üåç</span>
                        <span class="neo-nav-pill-text">T·∫•t c·∫£</span>
                    </button>
                    <button class="neo-nav-pill" data-type="domestic" aria-pressed="false" aria-label="Tin t·ª©c trong n∆∞·ªõc">
                        <span class="neo-nav-pill-icon" role="img" aria-hidden="true">üáªüá≥</span>
                        <span class="neo-nav-pill-text">Trong n∆∞·ªõc</span>
                    </button>
                    <button class="neo-nav-pill" data-type="international" aria-pressed="false" aria-label="Tin t·ª©c qu·ªëc t·∫ø">
                        <span class="neo-nav-pill-icon" role="img" aria-hidden="true">üåê</span>
                        <span class="neo-nav-pill-text">Qu·ªëc t·∫ø</span>
                    </button>
                </div>

                <!-- Status Indicator -->
                <div class="neo-status" role="status" aria-live="polite">
                    <div class="neo-status-dot" aria-hidden="true"></div>
                    <span class="neo-status-text">Live</span>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="neo-main" id="neo-main-content" role="main">
            <!-- Loading State -->
            <div class="neo-loading" id="neoLoadingContainer" role="status" aria-live="polite" aria-label="ƒêang t·∫£i tin t·ª©c">
                <div class="neo-spinner" aria-hidden="true">
                    <div class="neo-spinner-ring"></div>
                    <div class="neo-spinner-ring"></div>
                    <div class="neo-spinner-ring"></div>
                </div>
                <p class="neo-loading-text">ƒêang t·∫£i tin t·ª©c v·ªõi AI...</p>
            </div>

            <!-- News Grid -->
            <div class="neo-grid" id="neoNewsGrid" style="display: none;" role="grid" aria-label="Danh s√°ch tin t·ª©c">
                <!-- News items will be dynamically loaded here -->
            </div>

            <!-- Pagination -->
            <nav class="neo-pagination" id="neoPaginationContainer" style="display: none;" role="navigation" aria-label="Ph√¢n trang tin t·ª©c">
                <button class="neo-pagination-btn" id="neoPrevPageBtn" aria-label="Trang tr∆∞·ªõc">
                    <span>‚Üê Tr∆∞·ªõc</span>
                </button>
                <div class="neo-pagination-info" id="neoPaginationInfo" role="status" aria-live="polite">
                    <span class="neo-pagination-current">1</span>
                    <span class="neo-pagination-separator">/</span>
                    <span class="neo-pagination-total">1</span>
                </div>
                <button class="neo-pagination-btn" id="neoNextPageBtn" aria-label="Trang sau">
                    <span>Sau ‚Üí</span>
                </button>
            </nav>
        </main>

        <!-- Article Detail Modal -->
        <div class="neo-modal" id="neoArticleModal" role="dialog" aria-modal="true" aria-labelledby="neoModalTitle" aria-hidden="true">
            <div class="neo-modal-container">
                <!-- Modal Header -->
                <div class="neo-modal-header">
                    <h2 class="neo-modal-title" id="neoModalTitle"></h2>
                    <button class="neo-modal-close" id="neoModalClose" aria-label="ƒê√≥ng b√†i vi·∫øt" type="button">√ó</button>
                </div>
                
                <!-- Modal Content -->
                <div class="neo-modal-content">
                    <!-- Article Meta -->
                    <div class="neo-article-meta">
                        <span class="neo-article-source" id="neoArticleSource"></span>
                        <span class="neo-article-time" id="neoArticleTime"></span>
                        <a href="#" class="neo-article-link" id="neoArticleLink" target="_blank" rel="noopener noreferrer" aria-label="ƒê·ªçc b√†i vi·∫øt g·ªëc (m·ªü tab m·ªõi)">
                            üîó ƒê·ªçc b√†i g·ªëc
                        </a>
                    </div>
                    
                    <!-- Article Content -->
                    <div class="neo-article-content" id="neoArticleContent" role="article">
                        <!-- Article content will be loaded here -->
                    </div>
                </div>

                <!-- AI Interaction Panel -->
                <div class="neo-ai-panel" role="complementary" aria-labelledby="neoAiTitle">
                    <!-- AI Header -->
                    <div class="neo-ai-header">
                        <h3 class="neo-ai-title" id="neoAiTitle">ü§ñ NeoAI Assistant</h3>
                        <div class="neo-ai-quick-actions" role="group" aria-label="Ch·ª©c nƒÉng AI nhanh">
                            <button class="neo-ai-quick-btn" id="neoAutoSummaryBtn" type="button" aria-describedby="neo-auto-summary-desc">
                                üìã T√≥m t·∫Øt
                            </button>
                            <button class="neo-ai-quick-btn" id="neoAutoDebateBtn" type="button" aria-describedby="neo-auto-debate-desc">
                                üé≠ B√†n lu·∫≠n
                            </button>
                        </div>
                    </div>
                    
                    <!-- AI Input Area -->
                    <form class="neo-ai-input-area" onsubmit="return false;" role="form" aria-labelledby="neo-ai-input-label">
                        <label for="neoAiInput" id="neo-ai-input-label" class="sr-only">ƒê·∫∑t c√¢u h·ªèi ho·∫∑c nh·∫≠p ch·ªß ƒë·ªÅ b√†n lu·∫≠n</label>
                        <textarea 
                            class="neo-ai-input" 
                            id="neoAiInput" 
                            placeholder="ƒê·∫∑t c√¢u h·ªèi v·ªÅ b√†i b√°o ho·∫∑c nh·∫≠p ch·ªß ƒë·ªÅ b√†n lu·∫≠n v·ªõi NeoAI..."
                            rows="3"
                            aria-label="ƒê·∫∑t c√¢u h·ªèi v·ªÅ b√†i b√°o ho·∫∑c nh·∫≠p ch·ªß ƒë·ªÅ b√†n lu·∫≠n"
                            aria-describedby="neo-ai-input-help"
                            autocomplete="off"
                            spellcheck="true"
                        ></textarea>
                        
                        <!-- Hidden help text for screen readers -->
                        <div id="neo-ai-input-help" class="sr-only">
                            Nh·∫≠p c√¢u h·ªèi ho·∫∑c ch·ªß ƒë·ªÅ, sau ƒë√≥ ch·ªçn n√∫t H·ªèi ho·∫∑c B√†n lu·∫≠n. Ho·∫∑c nh·∫•n Ctrl+Enter ƒë·ªÉ g·ª≠i c√¢u h·ªèi.
                        </div>
                        <div id="neo-auto-summary-desc" class="sr-only">
                            T·ª± ƒë·ªông t√≥m t·∫Øt n·ªôi dung b√†i b√°o hi·ªán t·∫°i v·ªõi NeoAI
                        </div>
                        <div id="neo-auto-debate-desc" class="sr-only">
                            T·∫°o cu·ªôc tranh lu·∫≠n ƒëa g√≥c nh√¨n v·ªÅ b√†i b√°o hi·ªán t·∫°i v·ªõi NeoAI
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="neo-ai-actions" role="group" aria-label="Ch·ª©c nƒÉng AI chi ti·∫øt">
                            <button class="neo-ai-action-btn ask" id="neoAskBtn" type="button" aria-describedby="neo-ask-btn-desc">
                                üí≠ H·ªèi NeoAI
                            </button>
                            <button class="neo-ai-action-btn debate" id="neoDebateBtn" type="button" aria-describedby="neo-debate-btn-desc">
                                üó£Ô∏è B√†n lu·∫≠n
                            </button>
                        </div>
                        
                        <!-- Hidden descriptions for screen readers -->
                        <div id="neo-ask-btn-desc" class="sr-only">
                            ƒê·∫∑t c√¢u h·ªèi v·ªõi NeoAI v·ªÅ n·ªôi dung ƒë√£ nh·∫≠p
                        </div>
                        <div id="neo-debate-btn-desc" class="sr-only">
                            T·∫°o cu·ªôc tranh lu·∫≠n v·ªõi NeoAI v·ªÅ ch·ªß ƒë·ªÅ ƒë√£ nh·∫≠p
                        </div>
                    </form>
                    
                    <!-- AI Response -->
                    <div class="neo-ai-response" id="neoAiResponse" style="display: none;" role="region" aria-live="polite" aria-label="Ph·∫£n h·ªìi t·ª´ NeoAI">
                        <!-- AI responses will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="neo-fab-container" role="group" aria-label="Ch·ª©c nƒÉng nhanh">
            <button class="neo-fab" id="neoRefreshBtn" title="L√†m m·ªõi tin t·ª©c" aria-label="L√†m m·ªõi tin t·ª©c" type="button">
                üîÑ
            </button>
            <button class="neo-fab secondary" id="neoScrollTopBtn" title="L√™n ƒë·∫ßu trang" aria-label="Cu·ªôn l√™n ƒë·∫ßu trang" type="button">
                ‚¨ÜÔ∏è
            </button>
        </div>

        <!-- Toast Notifications -->
        <div class="neo-toast-container" id="neoToastContainer" role="region" aria-live="assertive" aria-label="Th√¥ng b√°o">
            <!-- Toast messages will appear here -->
        </div>
    </div>

    <!-- Enhanced Error Handling Script -->
    <script>
        // RENDER.COM OPTIMIZED: Enhanced error handling and debugging
        window.addEventListener('error', function(e) {
            console.error('üö® Global JavaScript Error:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error,
                stack: e.error?.stack,
                timestamp: new Date().toISOString()
            });
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® Unhandled Promise Rejection:', {
                reason: e.reason,
                promise: e.promise,
                timestamp: new Date().toISOString()
            });
        });

        // RENDER.COM OPTIMIZED: Connection status monitoring
        function updateNeoConnectionStatus() {
            const statusIndicator = document.querySelector('.neo-status');
            const statusText = document.querySelector('.neo-status-text');
            const statusDot = document.querySelector('.neo-status-dot');
            
            if (navigator.onLine) {
                statusText.textContent = 'Live';
                statusDot.style.background = 'var(--neo-accent-success)';
                statusIndicator.style.opacity = '1';
            } else {
                statusText.textContent = 'Offline';
                statusDot.style.background = 'var(--neo-accent-danger)';
                statusIndicator.style.opacity = '0.7';
            }
        }

        window.addEventListener('online', updateNeoConnectionStatus);
        window.addEventListener('offline', updateNeoConnectionStatus);

        // RENDER.COM OPTIMIZED: Enhanced mobile viewport handling
        function handleNeoViewportChanges() {
            // Update CSS custom property for actual viewport height
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);

            // Handle iOS Safari bottom bar and notch
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');
                document.documentElement.style.setProperty('--safe-area-inset-top', 'env(safe-area-inset-top)');
            }
        }

        window.addEventListener('resize', handleNeoViewportChanges);
        window.addEventListener('orientationchange', function() {
            setTimeout(handleNeoViewportChanges, 100);
        });

        // Initialize viewport handling
        handleNeoViewportChanges();

        // RENDER.COM OPTIMIZED: Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('üìä NeoAI Page Load Performance:', {
                    loadTime: Math.round(performance.now()),
                    domContentLoaded: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                    resources: performance.getEntriesByType('resource').length,
                    firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime || 'N/A',
                    firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime || 'N/A'
                });
            }
        });

        // RENDER.COM OPTIMIZED: Lightweight service worker registration
        if ('serviceWorker' in navigator && location.protocol === 'https:') {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ NeoAI ServiceWorker registered:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('‚ùå NeoAI ServiceWorker registration failed:', error);
                    });
            });
        }

        // RENDER.COM OPTIMIZED: Memory management for low-resource environments
        function neoMemoryCleanup() {
            // Clear old toast notifications
            const toastContainer = document.getElementById('neoToastContainer');
            if (toastContainer && toastContainer.children.length > 5) {
                const oldToasts = Array.from(toastContainer.children).slice(0, -3);
                oldToasts.forEach(toast => toast.remove());
            }
            
            // Clear browser cache if needed (for development)
            if (window.caches && Math.random() < 0.1) { // 10% chance
                caches.keys().then(function(cacheNames) {
                    if (cacheNames.length > 3) {
                        return Promise.all(
                            cacheNames.slice(0, -2).map(function(cacheName) {
                                return caches.delete(cacheName);
                            })
                        );
                    }
                });
            }
        }

        // Run memory cleanup every 5 minutes
        setInterval(neoMemoryCleanup, 5 * 60 * 1000);

        // RENDER.COM OPTIMIZED: Warm-up ping to prevent sleep (for free tier)
        function neoWarmUpPing() {
            if (document.visibilityState === 'visible') {
                fetch('/api/news/all?page=1&limit=1')
                    .then(response => {
                        if (response.ok) {
                            console.log('üî• NeoAI warm-up ping successful');
                        }
                    })
                    .catch(error => {
                        console.log('üßä NeoAI warm-up ping failed:', error);
                    });
            }
        }

        // Ping every 10 minutes to prevent Render free tier sleep
        setInterval(neoWarmUpPing, 10 * 60 * 1000);

        // RENDER.COM OPTIMIZED: Focus management for better UX
        document.addEventListener('keydown', function(e) {
            // Escape key to close modal
            if (e.key === 'Escape') {
                const modal = document.getElementById('neoArticleModal');
                if (modal && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            }
            
            // Enter key in AI input
            if (e.key === 'Enter' && e.ctrlKey && e.target.id === 'neoAiInput') {
                e.preventDefault();
                const askBtn = document.getElementById('neoAskBtn');
                if (askBtn && !askBtn.disabled) {
                    askBtn.click();
                }
            }
        });

        // Initialize connection status
        updateNeoConnectionStatus();

        console.log('üöÄ NeoAI News Portal initialized successfully!');
        console.log('üé® Theme: Purple Gradient with Glassmorphism');
        console.log('üì± Optimized for Render.com free tier');
    </script>

    <!-- Main Application Script -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
