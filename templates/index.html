<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∞ Ti·ªÅn Phong - Tin T·ª©c T√†i Ch√≠nh</title>
    
    <!-- Enhanced Meta Tags for Better SEO -->
    <meta name="description" content="Ti·ªÅn Phong - C·ªïng th√¥ng tin t√†i ch√≠nh, kinh t·∫ø h√†ng ƒë·∫ßu v·ªõi AI ph√¢n t√≠ch th√¥ng minh v√† giao di·ªán b√°o gi·∫•y truy·ªÅn th·ªëng">
    <meta name="keywords" content="ti·ªÅn phong, tin t·ª©c t√†i ch√≠nh, ch·ª©ng kho√°n, kinh t·∫ø, AI ph√¢n t√≠ch, b√°o t√†i ch√≠nh">
    <meta name="author" content="Ti·ªÅn Phong News Portal">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Ti·ªÅn Phong - Tin T·ª©c T√†i Ch√≠nh v·ªõi AI">
    <meta property="og:description" content="C·∫≠p nh·∫≠t tin t·ª©c t√†i ch√≠nh m·ªõi nh·∫•t v·ªõi ph√¢n t√≠ch AI th√¥ng minh">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/og-image.jpg">
    
    <!-- Traditional Newspaper Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23dc2626'/><text x='50' y='65' font-size='40' text-anchor='middle' fill='white' font-family='serif'>TP</text></svg>">
    
    <!-- Traditional Newspaper Fonts with fallbacks -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=Crimson+Text:wght@400;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Mobile App Experience -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Ti·ªÅn Phong">
    <meta name="theme-color" content="#dc2626">
    
    <!-- Preload critical CSS -->
    <link rel="preload" href="/static/style.css" as="style">
    <link rel="stylesheet" href="/static/style.css">
    
    <!-- Enhanced Error Handling Styles -->
    <style>
        /* Critical CSS for immediate loading */
        body {
            font-family: 'Crimson Text', 'Times New Roman', serif;
            background: #ffffff;
            color: #000000;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        /* Loading state styles */
        .initial-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-logo {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 900;
            color: #dc2626;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #6b7280;
            font-size: 1rem;
        }
        
        /* Error state styles */
        .error-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            text-align: center;
            background: #fef2f2;
            border: 2px solid #dc2626;
            border-radius: 8px;
        }
        
        .error-title {
            color: #dc2626;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .error-message {
            color: #374151;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .retry-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: background 0.2s ease;
        }
        
        .retry-button:hover {
            background: #b91c1c;
        }
        
        /* Hide main content until loaded */
        .main-app {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .main-app.loaded {
            opacity: 1;
        }
        
        /* Network status indicator */
        .network-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .network-status.online {
            background: #10b981;
            color: white;
        }
        
        .network-status.offline {
            background: #ef4444;
            color: white;
        }
        
        .network-status.connecting {
            background: #f59e0b;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Initial Loading Screen -->
    <div class="initial-loading" id="initialLoading">
        <div class="loading-logo">Ti·ªÅn Phong</div>
        <div class="loading-spinner"></div>
        <div class="loading-text">ƒêang kh·ªüi t·∫°o...</div>
    </div>
    
    <!-- Network Status Indicator -->
    <div class="network-status online" id="networkStatus">
        <span id="networkStatusText">üü¢ Tr·ª±c tuy·∫øn</span>
    </div>
    
    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <!-- Traditional Newspaper Masthead -->
        <header class="newspaper-masthead">
            <div class="masthead-container">
                <h1 class="newspaper-name">Ti·ªÅn Phong</h1>
                <p class="newspaper-tagline">www.tienphong.vn ‚Ä¢ Tin T·ª©c T√†i Ch√≠nh - Ch·ª©ng Kho√°n</p>
                <div class="publication-date">
                    <div class="date-separator"></div>
                    <span id="currentDate">ƒêang t·∫£i...</span>
                    <div class="date-separator"></div>
                </div>
            </div>
        </header>

        <!-- Traditional Navigation -->
        <nav class="newspaper-navigation">
            <div class="nav-container">
                <a href="#" class="nav-section active" data-category="all">Trang Ch·ªß</a>
                <a href="#" class="nav-section" data-category="domestic">Trong N∆∞·ªõc</a>
                <a href="#" class="nav-section" data-category="international">Qu·ªëc T·∫ø</a>
                <a href="#" class="nav-section" data-category="business">Doanh Nghi·ªáp</a>
                <a href="#" class="nav-section" data-category="finance">T√†i Ch√≠nh</a>
                <a href="#" class="nav-section" data-category="realestate">B·∫•t ƒê·ªông S·∫£n</a>
            </div>
        </nav>

        <!-- Main Newspaper Layout -->
        <div class="newspaper-layout">
            <!-- Traditional Sidebar Sections -->
            <aside class="newspaper-sidebar">
                <div class="sidebar-section">
                    <h3 class="section-header">Ch·ª©ng Kho√°n</h3>
                    <a href="#" class="section-link active" data-category="all">T·∫•t c·∫£ tin t·ª©c</a>
                    <a href="#" class="section-link" data-category="domestic">Th·ªã tr∆∞·ªùng trong n∆∞·ªõc</a>
                    <a href="#" class="section-link" data-category="international">Th·ªã tr∆∞·ªùng qu·ªëc t·∫ø</a>
                </div>
                
                <div class="sidebar-section">
                    <h3 class="section-header">Doanh Nghi·ªáp</h3>
                    <a href="#" class="section-link" data-category="business">Tin doanh nghi·ªáp</a>
                    <a href="#" class="section-link" data-category="earnings">K·∫øt qu·∫£ kinh doanh</a>
                </div>
                
                <div class="sidebar-section">
                    <h3 class="section-header">T√†i Ch√≠nh</h3>
                    <a href="#" class="section-link" data-category="finance">T√†i ch√≠nh - Ng√¢n h√†ng</a>
                    <a href="#" class="section-link" data-category="crypto">Ti·ªÅn s·ªë</a>
                </div>

                <div class="sidebar-section">
                    <h3 class="section-header">B·∫•t ƒê·ªông S·∫£n</h3>
                    <a href="#" class="section-link" data-category="realestate">Th·ªã tr∆∞·ªùng BƒêS</a>
                    <a href="#" class="section-link" data-category="projects">D·ª± √°n</a>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="content-masthead">
                    <h2 class="content-headline">Tin T·ª©c T√†i Ch√≠nh</h2>
                    <p class="content-subhead">C·∫≠p nh·∫≠t m·ªõi nh·∫•t t·ª´ th·ªã tr∆∞·ªùng t√†i ch√≠nh Vi·ªát Nam v√† th·∫ø gi·ªõi</p>
                </div>

                <!-- Enhanced Loading Indicator -->
                <div class="loading-indicator" id="loadingContainer">
                    <div class="loading-spinner"></div>
                    <p><strong>ƒêang t·∫£i tin t·ª©c...</strong></p>
                    <small style="color: #6b7280; margin-top: 0.5rem;">
                        N·∫øu t·∫£i qu√° l√¢u, vui l√≤ng <a href="#" onclick="location.reload()" style="color: #dc2626;">t·∫£i l·∫°i trang</a>
                    </small>
                </div>

                <!-- News Articles Grid -->
                <div class="news-articles" id="newsGrid" style="display: none;">
                    <!-- News articles will be loaded here -->
                </div>

                <!-- Enhanced Page Navigation -->
                <div class="page-navigation" id="paginationContainer" style="display: none;">
                    <button class="page-button" id="prevPageBtn">‚Üê Trang tr∆∞·ªõc</button>
                    <div class="page-info">
                        <span id="currentPage">1</span> / <span id="totalPages">1</span>
                    </div>
                    <button class="page-button" id="nextPageBtn">Trang sau ‚Üí</button>
                </div>
            </main>
        </div>
    </div>

    <!-- Article Modal - Newspaper Style -->
    <div class="article-modal" id="articleModal">
        <div class="modal-newspaper">
            <div class="modal-masthead">
                <h3 class="modal-headline" id="articleTitle">ƒêang t·∫£i...</h3>
                <button class="modal-close" id="closeBtn">√ó</button>
            </div>
            
            <div class="modal-subheader">
                <span class="modal-source" id="articleSource">ƒêang t·∫£i...</span>
                <span id="articleTime">ƒêang t·∫£i...</span>
                <a href="#" class="modal-link" id="articleLink" target="_blank">ƒê·ªçc b√†i g·ªëc</a>
            </div>
            
            <!-- Iframe for original webpage with newspaper effect -->
            <iframe class="article-frame" id="articleIframe" src="" loading="lazy" title="N·ªôi dung b√†i vi·∫øt"></iframe>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Enhanced initialization with better error handling
        document.addEventListener('DOMContentLoaded', async function() {
            const initialLoading = document.getElementById('initialLoading');
            const mainApp = document.getElementById('mainApp');
            const networkStatus = document.getElementById('networkStatus');
            const networkStatusText = document.getElementById('networkStatusText');
            
            // Update network status
            function updateNetworkStatus() {
                if (navigator.onLine) {
                    networkStatus.className = 'network-status online';
                    networkStatusText.textContent = 'üü¢ Tr·ª±c tuy·∫øn';
                } else {
                    networkStatus.className = 'network-status offline';
                    networkStatusText.textContent = 'üî¥ Ngo·∫°i tuy·∫øn';
                }
            }
            
            // Monitor network status
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            updateNetworkStatus();
            
            // Initialize traditional newspaper date
            function updateDate() {
                const now = new Date();
                const dateStr = now.toLocaleDateString('vi-VN', {
                    weekday: 'long',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                const dateEl = document.getElementById('currentDate');
                if (dateEl) dateEl.textContent = dateStr;
            }
            
            updateDate();
            setInterval(updateDate, 3600000); // Update every hour
            
            // Register Service Worker with error handling
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/static/sw.js', {
                        scope: '/'
                    });
                    console.log('‚úÖ Service Worker registered successfully:', registration.scope);
                    
                    // Handle service worker updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New service worker available
                                showUpdateNotification();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.warn('‚ö†Ô∏è Service Worker registration failed:', error);
                }
            }
            
            // Show update notification
            function showUpdateNotification() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #dc2626;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 1001;
                    font-size: 14px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.innerHTML = `
                    üì± C√≥ phi√™n b·∫£n m·ªõi! 
                    <button onclick="location.reload()" style="background: white; color: #dc2626; border: none; padding: 4px 8px; margin-left: 8px; border-radius: 4px; cursor: pointer;">C·∫≠p nh·∫≠t</button>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 10000);
            }
            
            // Enhanced error handling
            window.addEventListener('error', function(e) {
                console.error('üö® Global error:', e.error);
                showErrorMessage('ƒê√£ x·∫£y ra l·ªói kh√¥ng mong mu·ªën. Vui l√≤ng t·∫£i l·∫°i trang.');
            });

            window.addEventListener('unhandledrejection', function(e) {
                console.error('üö® Promise rejection:', e.reason);
                showErrorMessage('L·ªói x·ª≠ l√Ω d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
            });
            
            function showErrorMessage(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-container';
                errorDiv.innerHTML = `
                    <div class="error-title">‚ùå L·ªói h·ªá th·ªëng</div>
                    <div class="error-message">${message}</div>
                    <button class="retry-button" onclick="location.reload()">üîÑ T·∫£i l·∫°i trang</button>
                `;
                
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.innerHTML = '';
                    mainContent.appendChild(errorDiv);
                }
            }
            
            // Initialize the application
            try {
                // Hide initial loading and show main app
                setTimeout(() => {
                    initialLoading.style.opacity = '0';
                    setTimeout(() => {
                        initialLoading.style.display = 'none';
                        mainApp.classList.add('loaded');
                    }, 500);
                }, 500); // Short delay to show the loading screen
                
                console.log('üì∞ Traditional Ti·ªÅn Phong Newspaper Layout loaded!');
                console.log('üé® Theme: Classic Black & White Newspaper Design');
                console.log('üì± Enhanced error handling with retry mechanisms');
                console.log('üîÑ SYNC backend support with timeout protection');
                console.log('ü§ñ AI Characters: Original 6 characters');
                
            } catch (error) {
                console.error('‚ùå Failed to initialize app:', error);
                showErrorMessage('Kh√¥ng th·ªÉ kh·ªüi t·∫°o ·ª©ng d·ª•ng. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi internet v√† th·ª≠ l·∫°i.');
            }
        });
        
        // Progressive Web App install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üíæ PWA install prompt available');
            deferredPrompt = e;
            
            // Show custom install button (optional)
            const installButton = document.createElement('button');
            installButton.textContent = 'üì± C√†i ƒë·∫∑t ·ª©ng d·ª•ng';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: #dc2626;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 12px;
                z-index: 1000;
                font-weight: 600;
            `;
            
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`PWA install outcome: ${outcome}`);
                    deferredPrompt = null;
                    installButton.remove();
                }
            });
            
            // Auto-remove install button after 30 seconds
            setTimeout(() => installButton.remove(), 30000);
            document.body.appendChild(installButton);
        });
        
        // Handle PWA install success
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA installed successfully');
            deferredPrompt = null;
        });
    </script>
    
    <!-- Load main JavaScript -->
    <script src="/static/script.js" defer></script>
    
    <!-- Analytics and monitoring (optional) -->
    <script>
        // Basic performance monitoring
        window.addEventListener('load', () => {
            const perfData = performance.getEntriesByType('navigation')[0];
            const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
            console.log(`üìä Page load time: ${loadTime}ms`);
            
            // Report to analytics if needed
            if (loadTime > 3000) {
                console.warn('‚ö†Ô∏è Slow page load detected');
            }
        });
        
        // Monitor memory usage (development only)
        if ('memory' in performance) {
            setInterval(() => {
                const memory = performance.memory;
                const usedMB = Math.round(memory.usedJSHeapSize / 1048576);
                const totalMB = Math.round(memory.totalJSHeapSize / 1048576);
                
                if (usedMB > 50) { // Warn if using more than 50MB
                    console.warn(`üß† High memory usage: ${usedMB}MB / ${totalMB}MB`);
                }
            }, 30000); // Check every 30 seconds
        }
    </script>
</body>
</html>
