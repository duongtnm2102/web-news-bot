<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <!-- RENDER.COM OPTIMIZED: Enhanced mobile viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>üìä E-con News - AI-Powered Financial News</title>
    
    <!-- SEO & Social Meta -->
    <meta name="description" content="E-con News - AI-powered financial news portal with real-time updates and AI analysis. Modern colorful interface with glassmorphism design.">
    <meta name="keywords" content="AI news, financial news, E-con, colorful theme, modern UI, news portal">
    <meta name="author" content="E-con News Portal">
    <meta name="robots" content="index, follow">
    
    <!-- Mobile App Experience -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="E-con News">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-navbutton-color" content="#667eea">
    
    <!-- Prevent auto-zoom on iOS -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="{{ url_for('static', filename='script.js') }}" as="script">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#econ-main-content" class="sr-only sr-only-focusable">B·ªè qua ƒë·ªÉ ƒë·∫øn n·ªôi dung ch√≠nh</a>
    
    <!-- E-con App Container -->
    <div class="econ-app">
        <!-- Header Navigation -->
        <header class="econ-header" role="banner">
            <nav class="econ-nav">
                <!-- Logo -->
                <a href="/" class="econ-logo" aria-label="E-con News Portal - Trang ch·ªß">
                    <div class="econ-logo-icon" role="img" aria-label="Logo E-con">üìä</div>
                    <h1 class="econ-logo-text">E-con News</h1>
                </a>
                
                <!-- Navigation Pills -->
                <div class="econ-nav-pills" role="navigation" aria-label="Lo·∫°i tin t·ª©c">
                    <button class="econ-nav-pill active" data-type="all" aria-pressed="true" aria-label="T·∫•t c·∫£ tin t·ª©c">
                        <span class="econ-nav-pill-icon" role="img" aria-hidden="true">üåç</span>
                        <span class="econ-nav-pill-text">T·∫•t c·∫£</span>
                    </button>
                    <button class="econ-nav-pill" data-type="domestic" aria-pressed="false" aria-label="Tin t·ª©c trong n∆∞·ªõc">
                        <span class="econ-nav-pill-icon" role="img" aria-hidden="true">üáªüá≥</span>
                        <span class="econ-nav-pill-text">Trong n∆∞·ªõc</span>
                    </button>
                    <button class="econ-nav-pill" data-type="international" aria-pressed="false" aria-label="Tin t·ª©c qu·ªëc t·∫ø">
                        <span class="econ-nav-pill-icon" role="img" aria-hidden="true">üåê</span>
                        <span class="econ-nav-pill-text">Qu·ªëc t·∫ø</span>
                    </button>
                </div>

                <!-- Status Indicator -->
                <div class="econ-status" role="status" aria-live="polite">
                    <div class="econ-status-dot" aria-hidden="true"></div>
                    <span class="econ-status-text">Live</span>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="econ-main" id="econ-main-content" role="main">
            <!-- Loading State -->
            <div class="econ-loading" id="econLoadingContainer" role="status" aria-live="polite" aria-label="ƒêang t·∫£i tin t·ª©c">
                <div class="econ-spinner" aria-hidden="true">
                    <div class="econ-spinner-ring"></div>
                    <div class="econ-spinner-ring"></div>
                    <div class="econ-spinner-ring"></div>
                </div>
                <p class="econ-loading-text">ƒêang t·∫£i tin t·ª©c v·ªõi AI...</p>
            </div>

            <!-- News Grid -->
            <div class="econ-grid" id="econNewsGrid" style="display: none;" role="grid" aria-label="Danh s√°ch tin t·ª©c">
                <!-- News items will be dynamically loaded here -->
            </div>

            <!-- Pagination -->
            <nav class="econ-pagination" id="econPaginationContainer" style="display: none;" role="navigation" aria-label="Ph√¢n trang tin t·ª©c">
                <button class="econ-pagination-btn" id="econPrevPageBtn" aria-label="Trang tr∆∞·ªõc">
                    <span>‚Üê Tr∆∞·ªõc</span>
                </button>
                <div class="econ-pagination-info" id="econPaginationInfo" role="status" aria-live="polite">
                    <span class="econ-pagination-current">1</span>
                    <span class="econ-pagination-separator">/</span>
                    <span class="econ-pagination-total">1</span>
                </div>
                <button class="econ-pagination-btn" id="econNextPageBtn" aria-label="Trang sau">
                    <span>Sau ‚Üí</span>
                </button>
            </nav>
        </main>

        <!-- Article Detail Modal (Desktop/Tablet) -->
        <div class="econ-article-modal" id="econArticleModal" style="display: none;">
            <div class="econ-article-panel">
                <div class="econ-article-header">
                    <h2 class="econ-article-title" id="econArticleTitle"></h2>
                    <button class="econ-close-btn" id="econCloseBtn" aria-label="ƒê√≥ng b√†i vi·∫øt">√ó</button>
                </div>
                
                <div class="econ-article-meta">
                    <span class="econ-article-source" id="econArticleSource"></span>
                    <span class="econ-article-time" id="econArticleTime"></span>
                    <a href="#" class="econ-article-link" id="econArticleLink" target="_blank" rel="noopener noreferrer">
                        üîó ƒê·ªçc b√†i g·ªëc
                    </a>
                </div>
                
                <div class="econ-article-content" id="econArticleContent">
                    <!-- Article content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Floating Chat Widget -->
        <div class="econ-floating-chat" id="econFloatingChat">
            <!-- Minimized State -->
            <div class="econ-chat-bubble" id="econChatBubble">
                <div class="econ-chat-bubble-avatar">
                    <span class="econ-chat-bubble-icon">ü§ñ</span>
                    <div class="econ-chat-bubble-pulse"></div>
                </div>
                <div class="econ-chat-bubble-text">
                    <div class="econ-chat-bubble-title">AI Assistant</div>
                    <div class="econ-chat-bubble-subtitle">H·ªèi t√¥i v·ªÅ b√†i b√°o!</div>
                </div>
                <button class="econ-chat-bubble-close" id="econChatBubbleClose">√ó</button>
            </div>

            <!-- Maximized Chat Window -->
            <div class="econ-chat-window" id="econChatWindow" style="display: none;">
                <!-- Chat Header -->
                <div class="econ-chat-header">
                    <div class="econ-chat-avatar">ü§ñ</div>
                    <div class="econ-chat-info">
                        <h3 class="econ-chat-title">AI Assistant</h3>
                        <span class="econ-chat-status">Online</span>
                    </div>
                    <div class="econ-chat-actions">
                        <button class="econ-chat-minimize" id="econChatMinimize" aria-label="Thu nh·ªè">‚àí</button>
                        <button class="econ-chat-close" id="econChatClose" aria-label="ƒê√≥ng">√ó</button>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="econ-chat-messages" id="econChatMessages">
                    <div class="econ-welcome-message">
                        <div class="econ-message econ-message-ai">
                            <div class="econ-message-bubble">
                                Xin ch√†o! T√¥i l√† AI Assistant. H√£y h·ªèi t√¥i v·ªÅ b√†i b√°o ho·∫∑c s·ª≠ d·ª•ng c√°c n√∫t b√™n d∆∞·ªõi! ü§ñ‚ú®
                            </div>
                            <div class="econ-message-time">B√¢y gi·ªù</div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="econ-chat-input-area">
                    <!-- Quick Action Buttons -->
                    <div class="econ-quick-actions">
                        <button class="econ-quick-btn econ-summary-btn" id="econSummaryBtn">
                            üìã T√≥m t·∫Øt
                        </button>
                        <button class="econ-quick-btn econ-debate-btn" id="econDebateBtn">
                            üé≠ B√†n lu·∫≠n
                        </button>
                    </div>

                    <!-- Input Row -->
                    <div class="econ-input-row">
                        <div class="econ-input-container">
                            <textarea 
                                class="econ-chat-input" 
                                id="econChatInput" 
                                placeholder="Tin nh·∫Øn..."
                                rows="1"
                            ></textarea>
                            <button class="econ-send-btn" id="econSendBtn" aria-label="G·ª≠i tin nh·∫Øn">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="econ-fab-container" role="group" aria-label="Ch·ª©c nƒÉng nhanh">
            <button class="econ-fab" id="econRefreshBtn" title="L√†m m·ªõi tin t·ª©c" aria-label="L√†m m·ªõi tin t·ª©c">
                üîÑ
            </button>
            <button class="econ-fab econ-fab-secondary" id="econScrollTopBtn" title="L√™n ƒë·∫ßu trang" aria-label="Cu·ªôn l√™n ƒë·∫ßu trang">
                ‚¨ÜÔ∏è
            </button>
        </div>

        <!-- Toast Notifications -->
        <div class="econ-toast-container" id="econToastContainer" role="region" aria-live="assertive" aria-label="Th√¥ng b√°o">
            <!-- Toast messages will appear here -->
        </div>
    </div>

    <!-- Enhanced Error Handling Script -->
    <script>
        // RENDER.COM OPTIMIZED: Enhanced error handling and debugging
        window.addEventListener('error', function(e) {
            console.error('üö® Global JavaScript Error:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error,
                stack: e.error?.stack,
                timestamp: new Date().toISOString()
            });
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® Unhandled Promise Rejection:', {
                reason: e.reason,
                promise: e.promise,
                timestamp: new Date().toISOString()
            });
        });

        // RENDER.COM OPTIMIZED: Connection status monitoring
        function updateEconConnectionStatus() {
            const statusIndicator = document.querySelector('.econ-status');
            const statusText = document.querySelector('.econ-status-text');
            const statusDot = document.querySelector('.econ-status-dot');
            
            if (navigator.onLine) {
                statusText.textContent = 'Live';
                statusDot.style.background = 'var(--econ-accent-success)';
                statusIndicator.style.opacity = '1';
            } else {
                statusText.textContent = 'Offline';
                statusDot.style.background = 'var(--econ-accent-danger)';
                statusIndicator.style.opacity = '0.7';
            }
        }

        window.addEventListener('online', updateEconConnectionStatus);
        window.addEventListener('offline', updateEconConnectionStatus);

        // RENDER.COM OPTIMIZED: Enhanced mobile viewport handling
        function handleEconViewportChanges() {
            // Update CSS custom property for actual viewport height
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);

            // Handle iOS Safari bottom bar and notch
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');
                document.documentElement.style.setProperty('--safe-area-inset-top', 'env(safe-area-inset-top)');
            }
        }

        window.addEventListener('resize', handleEconViewportChanges);
        window.addEventListener('orientationchange', function() {
            setTimeout(handleEconViewportChanges, 100);
        });

        // Initialize viewport handling
        handleEconViewportChanges();

        // RENDER.COM OPTIMIZED: Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('üìä E-con Page Load Performance:', {
                    loadTime: Math.round(performance.now()),
                    domContentLoaded: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                    resources: performance.getEntriesByType('resource').length,
                    firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime || 'N/A',
                    firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime || 'N/A'
                });
            }
        });

        // RENDER.COM OPTIMIZED: Lightweight service worker registration
        if ('serviceWorker' in navigator && location.protocol === 'https:') {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ E-con ServiceWorker registered:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('‚ùå E-con ServiceWorker registration failed:', error);
                    });
            });
        }

        // RENDER.COM OPTIMIZED: Memory management for low-resource environments
        function econMemoryCleanup() {
            // Clear old toast notifications
            const toastContainer = document.getElementById('econToastContainer');
            if (toastContainer && toastContainer.children.length > 3) {
                const oldToasts = Array.from(toastContainer.children).slice(0, -2);
                oldToasts.forEach(toast => toast.remove());
            }
            
            // Clear old chat messages if too many
            const chatMessages = document.getElementById('econChatMessages');
            if (chatMessages && chatMessages.children.length > 20) {
                const oldMessages = Array.from(chatMessages.children).slice(0, -15);
                oldMessages.forEach(msg => msg.remove());
            }
        }

        // Run memory cleanup every 3 minutes
        setInterval(econMemoryCleanup, 3 * 60 * 1000);

        // RENDER.COM OPTIMIZED: Focus management for better UX
        document.addEventListener('keydown', function(e) {
            // Escape key to close split view
            if (e.key === 'Escape') {
                const splitContainer = document.getElementById('econSplitContainer');
                if (splitContainer && splitContainer.style.display !== 'none') {
                    splitContainer.style.display = 'none';
                    document.querySelector('.econ-main').style.display = 'block';
                }
            }
            
            // Enter key in chat input
            if (e.key === 'Enter' && !e.shiftKey && e.target.id === 'econChatInput') {
                e.preventDefault();
                const sendBtn = document.getElementById('econSendBtn');
                if (sendBtn) {
                    sendBtn.click();
                }
            }
        });

        // Initialize connection status
        updateEconConnectionStatus();

        console.log('üöÄ E-con News Portal initialized successfully!');
        console.log('üé® Theme: Colorful Rainbow with Glassmorphism');
        console.log('üì± Optimized for Render.com free tier');
    </script>

    <!-- Main Application Script -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
