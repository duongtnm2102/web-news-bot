<!DOCTYPE html>
<html lang="vi">
<head>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>ğŸ“° E-CON_NEWS.EXE - TERMINAL INTERFACE v2.024</title>
    
    <!-- SEO & Meta Tags -->
    <meta name="description" content="E-con News Terminal - AI-powered financial news portal with retro brutalism design. Real-time market analysis with terminal interface.">
    <meta name="keywords" content="terminal news, retro brutalism, AI news, financial tech, neo-brutalism, economic analysis">
    <meta name="author" content="E-con News Protocol">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#00ff00">
    <meta name="msapplication-navbutton-color" content="#00ff00">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="E-con News Terminal - AI Financial Analysis">
    <meta property="og:description" content="Retro brutalism news portal with AI-powered financial analysis and terminal interface">
    <meta property="og:image" content="/static/og-image.png">
    <meta property="og:url" content="{{ request.url }}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="E-con News Terminal">
    <meta name="twitter:description" content="AI-powered financial news with retro brutalism design">
    
    <!-- PWA Support -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="E-con News Terminal">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- REMOVED: CSP meta tag (frame-ancestors khÃ´ng hoáº¡t Ä‘á»™ng trong meta) -->
    <!-- CSP sáº½ Ä‘Æ°á»£c xá»­ lÃ½ qua HTTP header trong Flask -->
    
    <!-- Fonts - Performance Optimized -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¥ï¸</text></svg>">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23000000'/><text x='50' y='65' font-size='60' text-anchor='middle' fill='%2300ff00'>ğŸ–¥ï¸</text></svg>">
    
    <!-- FIXED: Stylesheets with proper url_for -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ range(1000, 9999) | random }}">
    
    <!-- FIXED: Preload Critical Resources vá»›i proper attributes -->
    <link rel="prefetch" href="{{ url_for('static', filename='script.js') }}" as="script">
    
    <!-- Performance Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "E-con News Terminal",
        "description": "AI-powered financial news portal with retro brutalism design",
        "url": "{{ request.url_root }}",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ request.url_root }}?search={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- FIXED: Critical CSS for immediate rendering -->
    <style>
        /* Critical CSS to prevent FOUC */
        body {
            margin: 0;
            padding: 0;
            background: #000000;
            color: #00ff00;
            font-family: 'JetBrains Mono', 'Share Tech Mono', 'Courier New', monospace;
            overflow-x: hidden;
        }
        
        /* Ensure navigation is visible immediately */
        .nav-tabs {
            background: #333333;
            border-bottom: 2px solid #00ff00;
            padding: 12px;
            display: flex !important;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            min-height: 60px;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .nav-tab {
            background: #000000;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 8px 16px;
            font-family: inherit;
            font-size: 10px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.15s ease-out;
            font-weight: bold;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            min-height: 36px;
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .nav-tab:hover {
            background: #00ff00;
            color: #000000;
            box-shadow: 0 0 10px #00ff00;
            transform: translateY(-1px);
        }
        
        .nav-tab.active {
            background: #ffb000;
            color: #000000;
            border-color: #ffb000;
            box-shadow: 0 0 15px #ffb000;
        }
        
        /* FIXED: Pagination styles */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: #111111;
            border-top: 2px solid #00ff00;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .pagination button {
            background: #000000;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 8px 16px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease-out;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #00ff00;
            color: #000000;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination button.active {
            background: #ffb000;
            color: #000000;
            border-color: #ffb000;
        }
        
        .pagination-info {
            color: #00ff00;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Loading indicator */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #00ff00;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #333333;
            border-top: 3px solid #00ff00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Skip Navigation Link -->
    <a href="#newsContainer" class="skip-link">Skip to main content</a>

    <!-- Scanline Effect -->
    <div class="scanline"></div>

    <!-- ASCII Art Header - FIXED Responsive -->
    <div class="ascii-header">
        <div class="ascii-art">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•‘
â•‘  â–ˆâ–ˆâ•”â•â•â•â•â•      â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•  â•‘
â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•‘
â•‘  â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘  â•‘
â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘  â•‘
â•‘  â•šâ•â•â•â•â•â•â•       â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•    â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•  â•‘
â•‘                           [ TERMINAL INTERFACE v2.024 ]                             â•‘
â•‘                         [ AI-POWERED FINANCIAL PROTOCOL ]                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        </div>
    </div>

    <!-- System Status Bar -->
    <div class="status-bar" role="alert" aria-live="polite">
        âš ï¸ Há»† THá»NG Cáº¢NH BÃO: REALITY.EXE ÄANG Gáº¶P Lá»–I NGHIÃŠM TRá»ŒNG - HÃƒY THáº¬N TRá»ŒNG âš ï¸
    </div>

    <!-- Command Bar -->
    <div class="command-bar">
        <div class="command-prompt">
            <label for="commandInput" class="prompt-text">root@econews:~#</label>
            <input type="text" 
                   class="command-input" 
                   id="commandInput"
                   placeholder="Nháº­p lá»‡nh..." 
                   autocomplete="off"
                   aria-label="Terminal command input"
                   title="GÃµ lá»‡nh nhÆ° 'help', 'news', 'ai', v.v.">
            <span class="cursor" aria-hidden="true">â–ˆ</span>
        </div>
        <div class="command-help">
            &gt; CÃ¡c lá»‡nh cÃ³ sáºµn: [NEWS] [SEARCH] [AI] [STATUS] [HELP] [MATRIX] [EXIT]
        </div>
    </div>

    <!-- FIXED: Navigation Tabs with Enhanced Structure -->
    <nav class="nav-tabs" role="navigation" aria-label="Danh má»¥c tin tá»©c" id="navigationTabs">
        <button class="nav-tab active" 
                data-category="all" 
                aria-pressed="true"
                title="Táº¥t cáº£ tin tá»©c tá»« má»i nguá»“n"
                type="button">
            [Táº¤T_Cáº¢_TIN_Tá»¨C.DAT]
        </button>
        <button class="nav-tab" 
                data-category="domestic" 
                aria-pressed="false"
                title="Tin tá»©c tÃ i chÃ­nh Viá»‡t Nam"
                type="button">
            [TIN_Tá»¨C_Ná»˜I_Äá»ŠA.VN]
        </button>
        <button class="nav-tab" 
                data-category="international" 
                aria-pressed="false"
                title="Tin tá»©c tÃ i chÃ­nh quá»‘c táº¿"
                type="button">
            [DÃ’NG_TIN_TOÃ€N_Cáº¦U.INT]
        </button>
        <button class="nav-tab" 
                data-category="tech" 
                aria-pressed="false"
                title="Tin tá»©c cÃ´ng nghá»‡"
                type="button">
            [CÃ”NG_NGHá»†.JS]
        </button>
        <button class="nav-tab" 
                data-category="crypto" 
                aria-pressed="false"
                title="Tin tá»©c tiá»n mÃ£ hÃ³a"
                type="button">
            [BLOCKCHAIN.BTC]
        </button>
        <button class="nav-tab" 
                data-category="ai" 
                aria-pressed="false"
                title="Tin tá»©c AI vÃ  há»c mÃ¡y"
                type="button">
            [Máº NG_NEURAL.AI]
        </button>
    </nav>

    <!-- System Stats Dashboard -->
    <section class="stats-grid" aria-label="Thá»‘ng kÃª há»‡ thá»‘ng">
        <div class="stat-box" tabindex="0">
            <span class="stat-emoji" aria-hidden="true">ğŸ‘¥</span>
            <div class="stat-label">NGÆ¯á»œI_DÃ™NG_HOáº T_Äá»˜NG</div>
            <div class="stat-value" id="activeUsers">1,337,420</div>
            <div class="stat-status">[TRá»°C_TUYáº¾N]</div>
        </div>
        <div class="stat-box" tabindex="0">
            <span class="stat-emoji" aria-hidden="true">ğŸ¤–</span>
            <div class="stat-label">CÃ‚U_Há»I_AI</div>
            <div class="stat-value" id="aiQueries">42,069</div>
            <div class="stat-status">[ÄANG_Xá»¬_LÃ]</div>
        </div>
        <div class="stat-box" tabindex="0">
            <span class="stat-emoji" aria-hidden="true">ğŸ“Š</span>
            <div class="stat-label">TIN_Tá»¨C_PHÃ‚N_TÃCH</div>
            <div class="stat-value" id="newsParsed">9,999</div>
            <div class="stat-status">[ÄÃƒ_Cáº¬P_NHáº¬T]</div>
        </div>
        <div class="stat-box" tabindex="0">
            <span class="stat-emoji" aria-hidden="true">âš¡</span>
            <div class="stat-label">Táº¢I_Há»†_THá»NG</div>
            <div class="stat-value" id="systemLoad">69%</div>
            <div class="stat-status">[Tá»I_Æ¯U]</div>
        </div>
    </section>

    <!-- Main News Container -->
    <main class="news-container" role="main">
        <!-- Loading State -->
        <div class="loading" id="loadingContainer" role="status" aria-live="polite">
            <div class="spinner" aria-hidden="true"></div>
            <div class="loading-text">ÄANG KHá»I Táº O GIAO THá»¨C TIN Tá»¨C...</div>
        </div>

        <!-- News Articles Container -->
        <div id="newsContainer" style="display: none;" role="region" aria-label="BÃ i viáº¿t tin tá»©c">
            <!-- News articles will be dynamically loaded here -->
        </div>
        
        <!-- FIXED: Pagination Container -->
        <div class="pagination" id="paginationContainer" style="display: none;" role="navigation" aria-label="PhÃ¢n trang">
            <button id="prevPageBtn" aria-label="Trang trÆ°á»›c">Â« TRÆ¯á»šC</button>
            <div class="pagination-info" id="pageInfo">Trang 1 / 1</div>
            <button id="nextPageBtn" aria-label="Trang sau">SAU Â»</button>
        </div>
    </main>

    <!-- FIXED: Chat Widget with Higher Z-Index -->
    <div class="chat-widget" role="complementary" aria-label="Trá»£ lÃ½ AI" style="z-index: 3000;">
        <!-- Chat Bubble (Minimized State) -->
        <div class="chat-bubble" id="chatBubble" role="button" tabindex="0" aria-label="Má»Ÿ trá»£ lÃ½ AI chat">
            <div class="chat-header">
                <span class="chat-avatar" aria-hidden="true">ğŸ¤–</span>
                <div>
                    <div class="chat-title">TRá»¢_LÃ_AI.EXE</div>
                    <div class="chat-subtitle">Sáºµn sÃ ng cho truy váº¥n...</div>
                </div>
            </div>
        </div>

        <!-- Chat Window (Maximized State) -->
        <div class="chat-window" id="chatWindow" role="dialog" aria-labelledby="chatWindowTitle" aria-modal="false" style="z-index: 3000;">
            <div class="chat-window-header">
                <h2 id="chatWindowTitle" class="chat-window-title">TERMINAL_AI v2.024</h2>
                <div class="chat-controls">
                    <button class="chat-btn" id="minimizeChat" aria-label="Thu nhá» chat" title="Thu nhá»">âˆ’</button>
                    <button class="chat-btn" id="closeChat" aria-label="ÄÃ³ng chat" title="ÄÃ³ng">Ã—</button>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages" role="log" aria-live="polite" aria-label="Tin nháº¯n chat">
                <div class="chat-message ai">
                    Há»†_THá»NG&gt; Trá»£ lÃ½ AI Ä‘Ã£ sáºµn sÃ ng. CÃ³ thá»ƒ phÃ¢n tÃ­ch tin tá»©c vÃ  tráº£ lá»i cÃ¢u há»i.<br>
                    CÃ¡c lá»‡nh cÃ³ sáºµn: [TÃ“M_Táº®T] [PHÃ‚N_TÃCH] [TRANH_LUáº¬N] [CÃ‚U_Há»I]
                </div>
            </div>
            
            <div class="chat-input-area">
                <div class="quick-actions">
                    <button class="quick-btn summary" id="summaryBtn" aria-label="TÃ³m táº¯t bÃ i viáº¿t hiá»‡n táº¡i">
                        ğŸ“‹ TÃ“M_Táº®T
                    </button>
                    <button class="quick-btn debate" id="debateBtn" aria-label="Báº¯t Ä‘áº§u tranh luáº­n vá» bÃ i viáº¿t hiá»‡n táº¡i">
                        ğŸ­ TRANH_LUáº¬N
                    </button>
                </div>
                <div class="chat-input-row">
                    <label for="chatInput" class="sr-only">Nháº­p tin nháº¯n cá»§a báº¡n</label>
                    <input type="text" 
                           class="chat-input" 
                           id="chatInput" 
                           placeholder="Nháº­p cÃ¢u há»i..."
                           aria-label="Nháº­p tin nháº¯n chat">
                    <button class="send-btn" id="sendBtn" aria-label="Gá»­i tin nháº¯n">Gá»¬I</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FIXED: Article Modal with proper spacing for chat -->
    <div class="modal" id="articleModal" role="dialog" aria-labelledby="modalTitle" aria-modal="true" aria-hidden="true">
        <div class="modal-content" style="margin-right: 450px; max-width: calc(90vw - 450px);">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">TRÃŒNH_XEM_BÃI_VIáº¾T.EXE</h2>
                <button class="close-btn" id="closeModal" aria-label="ÄÃ³ng bÃ i viáº¿t" title="ÄÃ³ng (Esc)">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody" role="document">
                <!-- Article content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Bottom Command Bar -->
    <footer class="bottom-bar" role="contentinfo">
        <div class="hotkeys" role="navigation" aria-label="PhÃ­m táº¯t">
            <span class="hotkey" tabindex="0" title="Hiá»ƒn thá»‹ trá»£ giÃºp">[F1] TRá»¢_GIÃšP</span>
            <span class="hotkey" tabindex="0" title="LÆ°u tráº¡ng thÃ¡i hiá»‡n táº¡i">[F2] LÆ¯U</span>
            <span class="hotkey" tabindex="0" title="ThoÃ¡t á»©ng dá»¥ng">[F3] THOÃT</span>
            <span class="hotkey" tabindex="0" title="Cháº¿ Ä‘á»™ matrix">[F4] MATRIX</span>
            <span class="hotkey" tabindex="0" title="LÃ m má»›i dá»¯ liá»‡u">[F5] LÃ€M_Má»šI</span>
        </div>
        <div class="system-info" role="status" aria-label="ThÃ´ng tin há»‡ thá»‘ng">
            <span class="status-online">TRáº NG_THÃI: TRá»°C_TUYáº¾N</span>
            <span aria-hidden="true">|</span>
            <span class="cpu-usage">CPU: 69%</span>
            <span aria-hidden="true">|</span>
            <span class="ram-usage">RAM: 420MB</span>
            <span aria-hidden="true">|</span>
            <time id="currentTime">00:00:00</time>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" role="region" aria-live="polite" aria-label="ThÃ´ng bÃ¡o">
        <!-- Toast notifications will appear here -->
    </div>

    <!-- Screen Reader Only Content -->
    <div class="sr-only">
        <h1>E-con News Terminal - Cá»•ng tin tá»©c tÃ i chÃ­nh Ä‘Æ°á»£c há»— trá»£ bá»Ÿi AI</h1>
        <p>Äiá»u hÆ°á»›ng báº±ng phÃ­m Tab. Nháº¥n F1 Ä‘á»ƒ Ä‘Æ°á»£c trá»£ giÃºp, F4 cho hiá»‡u á»©ng Ä‘áº·c biá»‡t, F5 Ä‘á»ƒ lÃ m má»›i.</p>
    </div>

    <!-- FIXED: Accessibility Styles -->
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --terminal-green: #00ff00;
                --terminal-red: #ff0000;
                --terminal-cyan: #00ffff;
                --bg-black: #000000;
                --terminal-white: #ffffff;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .scanline {
                display: none;
            }
        }

        /* Focus indicators */
        *:focus-visible {
            outline: 2px solid var(--terminal-cyan);
            outline-offset: 2px;
        }

        /* Skip link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--terminal-green);
            color: var(--bg-black);
            padding: 8px;
            text-decoration: none;
            z-index: 9999;
            font-family: var(--font-mono);
            font-weight: bold;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* FIXED: Mobile responsive navigation */
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 8px;
                gap: 2px;
            }
            
            .nav-tab {
                font-size: 8px;
                padding: 6px 8px;
                min-height: 32px;
                flex: 1;
                min-width: 80px;
            }
            
            .modal-content {
                margin-right: 0 !important;
                max-width: 90vw !important;
            }
            
            .chat-window {
                width: calc(100vw - 40px) !important;
                height: 50vh !important;
                bottom: 80px !important;
            }
            
            .pagination {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .nav-tab {
                font-size: 7px;
                padding: 4px 6px;
                min-height: 28px;
                letter-spacing: 0;
            }
        }
    </style>

    <!-- FIXED: Error Boundary and Performance Monitoring -->
    <script>
        // Global error handling
        window.addEventListener('error', function(e) {
            console.error('ğŸš¨ Lá»—i á»©ng dá»¥ng:', e.error);
            
            // Show user-friendly error message
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--bg-black, #000);
                border: 2px solid var(--terminal-red, #ff0000);
                color: var(--terminal-red, #ff0000);
                padding: 2rem;
                font-family: var(--font-mono, monospace);
                text-align: center;
                z-index: 10000;
                max-width: 400px;
            `;
            errorDiv.innerHTML = `
                <h3>Lá»–I Há»† THá»NG</h3>
                <p style="margin: 1rem 0;">ÄÃ£ xáº£y ra lá»—i khÃ´ng mong muá»‘n.</p>
                <button onclick="location.reload()" style="background: var(--terminal-red, #ff0000); color: white; border: none; padding: 0.5rem 1rem; font-family: var(--font-mono, monospace); cursor: pointer;">
                    KHá»I Äá»˜NG Láº I Há»† THá»NG
                </button>
            `;
            document.body.appendChild(errorDiv);
        });

        // FIXED: Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('ğŸ“Š BÃ¡o cÃ¡o hiá»‡u suáº¥t:', {
                    loadTime: Math.round(performance.now()),
                    domContentLoaded: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                    firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime || 'N/A'
                });
            }
            
            // FIXED: Check if navigation is visible
            const navTabs = document.querySelector('.nav-tabs');
            if (navTabs) {
                const computedStyle = window.getComputedStyle(navTabs);
                if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {
                    console.error('ğŸš¨ CÃ¡c tab Ä‘iá»u hÆ°á»›ng khÃ´ng hiá»ƒn thá»‹! Kiá»ƒm tra viá»‡c táº£i CSS.');
                } else {
                    console.log('âœ… CÃ¡c tab Ä‘iá»u hÆ°á»›ng Ä‘Ã£ táº£i thÃ nh cÃ´ng');
                }
            }
        });

        // Service Worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('{{ url_for("static", filename="sw.js") }}')
                    .then(function(registration) {
                        console.log('âœ… SW Ä‘Ã£ Ä‘Äƒng kÃ½:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('âŒ ÄÄƒng kÃ½ SW tháº¥t báº¡i:', error);
                    });
            });
        }

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
        }

        // Handle viewport changes for mobile
        function handleViewportChanges() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', handleViewportChanges);
        window.addEventListener('orientationchange', function() {
            setTimeout(handleViewportChanges, 100);
        });
        handleViewportChanges();

        // Connection status monitoring
        function updateConnectionStatus() {
            const statusElement = document.querySelector('.status-online');
            if (statusElement) {
                statusElement.textContent = navigator.onLine ? 'TRáº NG_THÃI: TRá»°C_TUYáº¾N' : 'TRáº NG_THÃI: NGOáº I_TUYáº¾N';
                statusElement.style.color = navigator.onLine ? 'var(--terminal-green)' : 'var(--terminal-red)';
            }
        }

        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);

        console.log('ğŸš€ Giao diá»‡n terminal Ä‘Ã£ sá»­a lá»—i Ä‘ang táº£i...');
    </script>

    <!-- Main Application Script -->
    <script src="{{ url_for('static', filename='script.js') }}?v={{ range(1000, 9999) | random }}" defer></script>

    <!-- Analytics & Monitoring (if needed) -->
    {% if config.get('ANALYTICS_ID') %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ config.ANALYTICS_ID }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ config.ANALYTICS_ID }}');
    </script>
    {% endif %}
</body>
</html>
